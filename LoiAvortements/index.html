<!DOCTYPE html>
<meta charset="utf-8">
<head>
		<title>Loi sur l'avortement</title>
		<script src="./JS/jquery.min.js" charset="utf-8"></script>
		<script src="./JS/d3.min.js" charset="utf-8"></script>
		<script src="./JS/tip.js" charset="utf-8"></script>
		<link href='https://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
		<link rel="stylesheet" href="./CSS/general.css" />
</head>		
<body>
<div class="box">
<p align="center">
  <svg></svg>
</div>
<!-- Script pour récupérer un array des positions des états :  "gridmapLayoutUsa" -->
<script src="./JS/etats.js"></script>
<script>

//variables pour la taille d'origine du svg (qui s'adaptera avec la viewbox)
var width = 700,
    height = 580;

var r = (width/(14*Math.sqrt(3)));
	
// Echelle X : le range a été mis "a la main" pour que les états soient assez espacé
var xRange = function(x) {
	return (x+1)*(width/14);
}
// Echelle Y :  le range a été mis "a la main" pour que les états soient assez espacé
var yRange = function(y) {
	return (y+1)*(3/2)*r;
}
//Echelle des couleurs
var color = function(x) {
console.log(x);
	if (x==3)
		return '#f4aa59';
	else if (x==2)
		return '#4c7d95';
	else if (x==1)
		return '#f7c38a';
	else
		return '#c3c3c3';		
}


//Ouverture du csv des données dans une fonction
d3.csv("EtatsUSA.csv", function(csv) {
//on appelle les données data
var data=csv;


//fonction pour chercher la valeur dans data en fonction du nom
var getData = function(name) {
var index=-1;
	for (i = 0; i < data.length; i++) { 
		if (data[i].Etat==name) 
			index = data[i].Valeur;
}
return index;
} 
 
// fonction de dessin d'une ligne	
var lineFunction = d3.svg.line()
                      .x(function(d) { return d.x; })
                      .y(function(d) { return d.y; })
                      .interpolate("linear");

//fonction pour indiquer les points pour faire l'héxagone en fonction du centre et du rayon.					  
function hexagon(a,b,r) { 
		return [{x:a,y:b-r},{x: a+(Math.sqrt(3)/2)*r,y: b-(1/2)*r},{x: a+(Math.sqrt(3)/2)*r,y: b+(1/2)*r},{x: a,y: b+r},{x: a-(Math.sqrt(3)/2)*r,y: b+(1/2)*r},{x: a-(Math.sqrt(3)/2)*r,y: b-(1/2)*r},{x:a,y:b-r}];
	};
	
//Création d'une view box pour que les espaces entre les éléments du svg restent constant.
var svg = d3.select('svg')
	.attr("viewBox", [
       0,
       0,
       width,
       height
     ].join(" "));
	 
	 
//Tiptool si besoin
/*var tip = d3.tip()
		.attr('class', 'd3-tip')
		.offset([-5, -(1/2)*r])
		.html(function(d) {
			return d.name;
		});	*/
		
		
//Dessin des hexagones en parcourant la carte des USA 
svg.selectAll("path")
		.data(gridmapLayoutUsa)
		.enter()
		.append("path")
		.attr("class","hexagon")
		.attr("d", function(d) {
		if (d.y%2==1){
			return lineFunction(hexagon(xRange(d.x),yRange(d.y),r));}
			else {
			return lineFunction(hexagon(xRange(d.x)+(Math.sqrt(3)/2)*r,yRange(d.y),r));}
			})
		.attr("fill", function(d) {
			return color(getData(d.key));
		})
		.attr("stroke", "white")
		.attr("stroke-width","1")
		.attr("opacity",0.6);
		
// Dessin du nom des Etats	
svg.selectAll("text")
		.data(gridmapLayoutUsa)
		.enter()
		.append("text")
		.attr("text-anchor","middle")
		.attr("class","nomEtat")
		.attr("x",function(d) {
			if (d.y%2==1){
				return xRange(d.x);}
			else {
				return (xRange(d.x)+(Math.sqrt(3)/2)*r);}
			})
		.attr("y", function(d) {
			return yRange(d.y);
		})
		.text(function(d) {return d.key;})
		.style("fill","white");
		
// Si on veut un tooltip sur les hexagones		
/*var group = svg.append("g");		
group.selectAll("path")
		.data(gridmapLayoutUsa)
		.enter()
		.append("path")
		.attr("class","hexagon")
		.attr("d", function(d) {
		if (d.y%2==1){
			return lineFunction(hexagon(xRange(d.x),yRange(d.y),r));}
			else {
			return lineFunction(hexagon(xRange(d.x)+(Math.sqrt(3)/2)*r,yRange(d.y),r));}
			})
		.attr("fill", function(d) {
			return color(getData(d.key));
		})
		.attr("stroke", "white")
		.attr("stroke-width","1")
		.attr("opacity",0.1)
		.on('mouseover', tip.show)
		.on('mouseout', tip.hide);	
		
svg.call(tip); */	

});	
</script>

</body>